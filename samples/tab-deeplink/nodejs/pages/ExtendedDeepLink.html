<html>
    <script src="https://res.cdn.office.net/teams-js/2.0.0/js/MicrosoftTeams.min.js" crossorigin="anonymous"></script>

    <style>
    pre {
        overflow-x: scroll;
    }

    .callDeeplinkButton {
        font-family: "Segoe UI","Apple Color Emoji","Segoe UI Emoji","Segoe UI Web";
        font-weight: 700;
        background-color: #444791;
        cursor: pointer;
        color: white;
        width: 50px;
        border-radius: 8px;
        border: none;
        margin-top: 1rem;
        padding: 10px 0px;
        text-align: center;
        text-decoration: none;
    }

    .callDeeplinkButton:hover {
        box-shadow: 0 8px 16px 0 rgba(0, 0, 0, 0.2);
    }

    .inputContainer {
        margin-top: 10px;
    }

    .container {
        font-family: "Segoe UI","Apple Color Emoji","Segoe UI Emoji","Segoe UI Web";
        font-size: 14px;
    }

    .card {
        box-shadow: 0 4px 8px 0 rgb(0 0 0 / 20%);
        width: 27rem;
        min-height: 18rem;
        overflow: hidden;
        margin-left: 2rem;
        margin-top: 0.5rem;
    }

    .card-container-div {
        padding-bottom: 2rem;
        display: flex;
    }

    .card-header
    {
        margin-left: 1rem;
        margin-right: 1rem;
        margin-top: 1rem;
        padding-top: 0.5rem;
        font-size: 16px !important;
    }

    button {
        margin: 1rem 8.5rem 1rem 11.5rem;
    }

    .form-container {
        margin-left: 1rem;
    }

    .card-body {
        margin-left: 0.5rem;
    }
    </style>

    <script type="text/javascript">
    microsoftTeams.app.initialize();

    function selectPeople() {
        microsoftTeams.app.initialize().then(() => {
            microsoftTeams.people.selectPeople({ setSelected: [], openOrgWideSearchInChatOrChannel: true, singleSelect: false }).then((people) => {
                if (people) {
                    document.getElementById("Attendee").value = (people.map((p) => p.email)).join(",");
                }
            }).catch((error) => {
                console.log(error);
            });
        });
    }

    function onCallDeepLinkButtonClick(callModalities) {
        microsoftTeams.app.initialize().then(() => {
            microsoftTeams.people.selectPeople({ setSelected: [], openOrgWideSearchInChatOrChannel: true, singleSelect: false }).then((people) => {
                if (people) {
                    if(microsoftTeams.call.isSupported()) {
                        microsoftTeams.call.startCall({ targets: people.map((p) => p.email),
                            requestedModalities: [callModalities]})
                        .then((result) => {
                            console.log(result);
                        }).catch((error) => {
                                console.log(error);
                        });
                    }
                    else {
                        alert("Call isn't supported");
                    }
                }
            }).catch((error) => {
                console.log(error);
            });
        });
    }

    function onSchedulingDialogClick() {
        var subjectInput = document.getElementById("Subject");
        var startTimeInput = document.getElementById("StartTime");
        var endTimeInput = document.getElementById("EndTime");
        var contentInput = document.getElementById("Content");
        var attendeeInput = document.getElementById("Attendee");

        if (subjectInput.value.trim() !== "" && startTimeInput.value !== "" && endTimeInput.value !== "" && attendeeInput.value !== "") {
            var meetingDetails =
            {
                attendees: attendeeInput.value.split(","),
                content: contentInput.value.trim(),
                endTime: endTimeInput.value,
                startTime: startTimeInput.value,
                subject: subjectInput.value.trim(),
            };
            
            microsoftTeams.app.initialize().then(() => {
                microsoftTeams.calendar.composeMeeting(meetingDetails).
                   then((result) => { console.log(result); }).
                   catch((error) => { console.log(error); });
            });

            // microsoftTeams.app.openLink(`https://teams.microsoft.com/l/meeting/new?subject=${meetingDetails.subject}&startTime=${meetingDetails.startTime}&endTime=${meetingDetails.endTime}&content=${meetingDetails.content}&attendees=${meetingDetails.attendees}`)
        }
    }

    function onAppInstallDialogClick() {
        var appInstallDetails = { appID: "c4c35992-6454-4b49-b8d3-b16ce2e36db2" };
        if(microsoftTeams.appInstallDialog.isSupported()) {
            const dialogPromise = microsoftTeams.appInstallDialog.openAppInstallDialog(appInstallDetails).
            then((result) => { console.log(result); }).
                catch((error) => { console.log(error); });
        }
        else { console.log("App install capability not supported."); }
    }
    </script>

    <div>
    <div class="container">
        <div class="card-container-div">
        <div>
            <div class="card">
            <div class="card-body">
                <div class="card-header">
                <b>Audio call members using the v2.0 SDK method</b>
                </div>
                <div class="configure-header">
                To use this option, configure the function using following
                parameters
                <!-- Since we are using pre tag for having the code snippet in specified format ignoring the indentation here -->
                <pre>
    microsoftTeams.call.startCall({ targets: usersEmailArray,
            requestedModalities: [microsoftTeams.call.CallModalities.Audio]})
        .then((result) => {
            console.log(result);
        }).catch((error) => {
                console.log(error);
        });
                            </pre
                >
                </div>
                <div>Select members and make a call.</div>
            </div>
            <button
                data-id="default"
                class="callDeeplinkButton"
                onclick="onCallDeepLinkButtonClick(microsoftTeams.call.CallModalities.Audio)"
            >
                Select
            </button>
            </div>
        </div>
        <div>
            <div class="card">
            <div class="card-body">
                <div class="card-header">
                <b>Video call members using the v2.0 SDK method</b>
                </div>
                <div class="configure-header">
                To use this option, configure the function using following
                parameters
                <!-- Since we are using pre tag for having the code snippet in specified format ignoring the indentation here -->
                <pre>
    microsoftTeams.call.startCall({ targets: usersEmailArray,
        requestedModalities: [microsoftTeams.call.CallModalities.Video]})
    .then((result) => {
        console.log(result);
    }).catch((error) => {
            console.log(error);
    });
                            </pre
                >
                </div>
                <div>Select members and make a call.</div>
            </div>
            <button
                class="callDeeplinkButton"
                onclick="onCallDeepLinkButtonClick(microsoftTeams.call.CallModalities.Video)"
            >
                Select
            </button>
            </div>
        </div>
        </div>
        <div class="card-container-div">
        <div>
            <div class="card">
            <div class="card-body">
                <div class="card-header"><b>Open a scheduling dialog</b></div>
                <div class="configure-header">
                To use this option, configure the function using following
                parameters
                <!-- Since we are using pre tag for having the code snippet in specified format ignoring the indentation here -->
                <pre>
    microsoftTeams.calendar.composeMeeting({
                attendees: emailArray,
                content: "Meeting Content",
                startTime: "2022-06-17T21:30+05:30",
                endTime: "2022-06-17T22:30+05:30",
                subject: "Meeting Subject",
            })
        .then((result) => { console.log(result); })
        .catch((error) => { console.log(error); })
                                </pre
                >
                </div>
                <div class="form-container">
                <form>
                    <span>Add Details for scheduling dialog</span>
                    <div class="inputContainer">
                    <label for="Subject">Subject:</label>
                    <input type="text" id="Subject" value="" required />
                    </div>
                    <div class="inputContainer">
                    <label for="Content">Content:</label>
                    <input type="text" id="Content" value="" />
                    </div>
                    <div class="inputContainer" style="display:flex;">
                    <label for="Attendee">Attendees: </label>
                    <input type="text" id="Attendee" value="" disabled required />
                    <button onclick="selectPeople()" style="margin:0px 4px;">
                        Select
                    </button>
                    </div>
                    <div class="inputContainer">
                    <label for="StartTime">Start Time:</label>
                    <input
                        type="datetime-local"
                        id="StartTime"
                        value=""
                        required
                    />
                    </div>
                    <div class="inputContainer">
                    <label for="EndTime">End Time:</label>
                    <input type="datetime-local" id="EndTime" value="" required />
                    </div>
                    <div class="inputContainer">
                    <span id="dialogDeeplink"></span>
                    </div>
                </form>
                </div>
            </div>
            <button
                data-id="singleSelect"
                type="submit"
                class="callDeeplinkButton"
                style="width:130px;margin-left:8.5rem;"
                onclick="onSchedulingDialogClick()"
            >
                Schedule Meeting
            </button>
            </div>
        </div>
        <div>
            <div class="card">
            <div class="card-body">
                <div class="card-header">
                <b>Open a Polly app install dialog</b>
                </div>
                <div class="configure-header">
                To use this option, configure the function using following
                parameters
                <!-- Since we are using pre tag for having the code snippet in specified format ignoring the indentation here -->
                <pre>
    microsoftTeams.appInstallDialog.openAppInstallDialog({ appID: "appId"})
    .then((result) => {/*Successful operation*/})
    .catch((error) => {/*Unsuccessful operation*/});
                            </pre
                >
                </div>
            </div>
            <button
                class="callDeeplinkButton"
                onclick="onAppInstallDialogClick()"
            >
                Open
            </button>
            </div>
        </div>
        </div>
    </div>
    </div>
</html>